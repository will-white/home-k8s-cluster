---
# ExternalSecret - Fetches secrets from Bitwarden
# Use this instead of plain Kubernetes Secrets for sensitive data
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: <APP-NAME>-secret
spec:
  # How often to check Bitwarden for changes
  refreshInterval: 5m

  # Which secret store to use
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden-login  # Options: bitwarden-login, bitwarden-fields, bitwarden-notes

  # Target Kubernetes Secret to create
  target:
    name: <APP-NAME>-secret
    template:
      engineVersion: v2
      data:
        # Map Bitwarden fields to secret keys
        # Example for bitwarden-login:
        USERNAME: "{{ .username }}"
        PASSWORD: "{{ .password }}"

        # Example for bitwarden-fields (custom fields):
        # API_KEY: "{{ .api_key }}"
        # TOKEN: "{{ .token }}"

  # Fetch data from Bitwarden item
  dataFrom:
    - extract:
        key: <bitwarden-item-id>  # Get this from Bitwarden

  # Alternative: Fetch specific fields
  # data:
  #   - secretKey: API_KEY
  #     remoteRef:
  #       key: <bitwarden-item-id>
  #       property: api_key

---
# NOTES:
# 1. Get Bitwarden item ID from your Bitwarden vault
# 2. For bitwarden-login: Stores username/password
# 3. For bitwarden-fields: Stores custom fields
# 4. For bitwarden-notes: Stores JSON/YAML in notes field
# 5. Reference in HelmRelease:
#    envFrom:
#      - secretRef:
#          name: <APP-NAME>-secret
